---
title: "Visualization_part(a) - Intro to ggplot2 + Bar charts"
output: html_document
---
In this lab, you we learn how to use ggplot to tackle geoms and astetics, ultimately designing beautiful and persuasive graphics. You will also learn how to create differnt Bar Charts in R. :)

- you can create R_Markdown cells (chunks) by using:
  -  windows:   <ctrl + alt + i>
  -  Mac:       <command + alt + i>
  

```{r}
# Load required libraries
library(ggplot2)
library(dplyr)
library(magrittr)
library(gridExtra)

install.packages("gridExtra", dependencies = TRUE)

# Use ggplot function to plot
# Using only ggplot function will create a blank canvas
```


# 1: Scatter Plot
A scatter plot is a graphical display of relationship between two sets of data. They are good if you to want to visualize how two variables are correlated. 

- Use 'help(mpg)' to learn more about data
```{r}
# mpg belongs to the ggplot library
colnames(mpg)
head(mpg)
```

```{r}
# Provide aesthetics to blank canvas
ggplot(data=mpg, aes(x=cty, y=hwy))
```

```{r}
# Provide aesthetics to blank canvas
ggplot(mpg, aes(x=cty,y=hwy))
```

```{r}
# Generate canvas + add axis + plot data
# The point geom is used to create scatterplots.
ggplot(mpg, aes(x=cty,y=hwy)) + geom_point()
```

```{r}
# Map additional dimension to aesthetics. In this case color
## -> In this case we can color points based on "class" which refers to "type" of car. In this case, each class of car will be shown by a different color in R
ggplot(mpg, aes(x=cty,y=hwy, color=class)) + geom_point()
```

```{r}
# Map dimension as shape
ggplot(mpg, aes(x=cty,y=hwy, shape=drv, color=drv)) + geom_point()
```

```{r}
# Map dimension as size
ggplot(mpg, aes(x=cty,y=hwy, size=displ)) + geom_point()
```

```{r}
# Mapping multi dimensions 
ggplot(mpg, aes(x=cty,y=hwy, size=displ, color=drv))+geom_point()
```

```{r}
# Limitation 1: When number of factors are more than 6, there are not enough shapes generated by ggplot
ggplot(mpg, aes(x=cty,y=hwy, shape=class)) + geom_point()

```

```{r}
# Limitations 2:  Avoid using categorical variables for size, ggplot gives you a warning
ggplot(mpg, aes(x=cty,y=hwy, size=drv)) + geom_point()
## 
```

```{r}
# Quiz : Plot  "toyota" cars mpg (manufacturer == "toyota") to compare "class"  vs "cty" and set the color based on "model"

mpg_toyota <- mpg[mpg$manufacturer == "toyota",]
ggplot(mpg_toyota, aes(x=class,y=cty, color=model)) + geom_point()
```



# 2- Bar Plot
```{r}
## Creating  dummy dataframes
### -> Dose: Amount of Supplement given
### -> Len: Length of tooth in Animal

df1 <- data.frame(dose=c("D0.5", "D1", "D2"),
                len=c(4.2, 10, 29.5))

## adding a new column to dataframe
df2 <- data.frame(supp=rep(c("VC", "OJ"), each=3),
                  dose=rep(c("D0.5", "D1", "D2"), 2),
                  len=c(6.8, 15, 33, 4.2, 10, 29.5))
```


```{r}
# we use df1 for the BarPlot
df1
colnames(df1)
```


```{r}
## geom_bar() creates a BarPlot in R
p1 <- ggplot(data=df1, aes(x=dose, y=len)) + 
  geom_bar(stat="identity")
p1
## Quiz: try to remove [y=len] and [stat="identity"] to see what happens?
p11 <- ggplot(data=df1, aes(x=dose)) + 
  geom_bar()
p11
```


```{r}
ggplot(data=df1, aes(x=dose, y=len)) +
        geom_bar(stat="identity") + coord_flip()
```




```{r}
## gridExtra: Provides a number of user-level functions to work with "grid" graphics, notably to arrange multiple grid-based plots on a page, and draw tables.
library(gridExtra)
p1 <- ggplot(data=df1, aes(x=dose, y=len)) +
      geom_bar(stat="identity")

#p2 <- ggplot(data=df1, aes(x=dose, y=len)) +
     # geom_bar(stat="identity") + coord_flip()
p2<-p1+coord_flip()

grid.arrange(p1, p2, ncol=2)
```
## BarChart: Exapmle 2 
- about the dataframe:'mtcars' dataframe: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973â€“74 models). Use help(mtcars) to learn more. 


```{r}
ggplot(mtcars, aes(x=(cyl))) + geom_bar(stat="bin")

```


## 2-a Stacked bar chart: 
A stacked bar graph (or stacked bar chart)  is a chart that uses bars to show comparisons between categories of data, but with ability to break down and compare parts of a whole. Each bar in the chart represents a whole, and segments in the bar represent different parts or categories of that whole.

- Stacked bars do a good job of featuring the total and also providing a hint as to how the total for each category value is divided into parts.


```{r}
# supplements: Vitamin C(VC), and Orange Juice (OJ)
# 

p1 <- ggplot(data=df2, aes(x=dose, y=len, fill=supp)) +
      geom_bar(stat="identity")

p1
```

## 2-b Grouped bar charts:
Grouped bar charts are Bar charts in which multiple sets of data items are compared, with a single color used to denote a specific series across all sets. As with basic Bar charts, both vertical and horizontal versions of grouped bar charts are available.
```{r}
# Check the Global Environment to see detials of df2

## Stacked
p1 <- ggplot(data=df2, aes(x=dose, y=len, fill=supp)) +
      geom_bar(stat="identity") +
      coord_cartesian(ylim = c(0, 60))
p1

## Grouped : Using the geom_bar (position="dodge") places the two bars side by side
p2 <- ggplot(data=df2, aes(x=dose, y=len, fill=supp)) +
      geom_bar(stat="identity", position="dodge") +
      coord_cartesian(ylim = c(0, 60))
p2

grid.arrange(p1, p2, nrow=1, ncol=2)

# Quiz: What does 'coord_cartesian(ylim = c(0, 60))' do?
```
```{r}
## Grouped : Using the geom_bar (position="dodge") places the two bars side by side
p2 <- ggplot(data=df2, aes(x=dose, y=len, fill=supp)) +
      geom_bar(stat="identity", position="dodge")

## Grouped: customize the dodging
p3 <- ggplot(data=df2, aes(x=dose, y=len, fill=supp)) +
      geom_bar(stat="identity", position = position_dodge(width = 0.6))

grid.arrange(p2,p3, nrow=1, ncol=2)
```
## 2-c BarPlot Miscellaneous:
###  Point to remember in bar chart
```{r}
# Make sure one axis is categorical
ggplot(mtcars, aes(x = cyl)) + geom_bar()

# Quiz: What is wrong with this plot?? How you can fix 
ggplot(mtcars, aes(x = (as.character(cyl)))) + geom_bar()

```

### Highlighting
- Do you want to learn more about the dataset? use 'help(midwest)'

```{r}
library(magrittr)
head(midwest)
dim(midwest)
```

```{r}

## 'mutate()' adds new variables and preserves existing; transmute drops existing variables.
midwest %>% 
  mutate(highlight_flag = ifelse(state == 'IL', "Yes", "No")) %>% 
  ggplot(aes(x = state, fill = highlight_flag)) +
  geom_bar()

```

### Ordering categories
```{r}
p1 <- ggplot(mtcars, aes(x = row.names(mtcars), y = mpg)) +
        geom_bar(stat = "identity") +
        coord_flip() +
        ggtitle("Fig. A: Cars mpg")

# order bars
p2 <- ggplot(mtcars, aes(x = reorder(row.names(mtcars), mpg), y = mpg)) +    #reorder sorts in value wise
        geom_bar(stat = "identity") +
        coord_flip() +
        ggtitle("Fig. B: sorted Cars mpg")

grid.arrange(p1, p2, ncol = 2)
```


#### Text annotation
```{r}
## -> geom_text() adds only text to the plot. [vjust: vertical Justification]
## -> geom_label() draws a rectangle behind the text, making it easier to read.

# Outside bars
p1 <- ggplot(data=df1, aes(x=dose, y=len)) +
      geom_bar(stat="identity") +
      geom_text(aes(label=len), vjust=-0.2, color="purple", size=3.5)

# Inside bars
p2 <- ggplot(data=df1, aes(x=dose, y=len)) +
      geom_bar(stat="identity") +
      geom_text(aes(label=len), vjust=2, color="white", size=3.5)

grid.arrange(p1,p2, ncol=2)
```
### Cumlative Sum: The cumulative sum is used to determine the total sum of a variable or group and helps us to understand the changes in the values of that variable or group over time. While creating the cumulative, we must be sure that the total sum and the cumulative sum of the last value (depending on the direction of sum) are same. We can use mutate function of dplyr package to find the cumulative and create a column for it.
```{r}
library(plyr)

#library(dplyr)

## Original df2 : calculate "CumlativeSum"

## ddply: Split Data Frame, Apply Function, And Return Results In A Data Frame.
## -> cumsum(): Returns a vector whose elements are the cumulative sums



df2_sorted <- arrange(df2, dose, supp) 

## Quiz: Use console to check the difference between 'df2', and 'df2_sorted'

```

```{r}
## CumSum of df2 (wihtout sorting)
df2_cumsum <- ddply(df2, "dose",
                    transform, label_ypos=cumsum(len))

## CumSum of sorted df2 using df2_sorted
df2_cumsum_sorted <- ddply(df2_sorted, "dose",
                           transform, label_ypos=cumsum(len))

## Quiz: Use console to check the difference between, 'df2_cumsum' and 'df2_cumsum_sorted'. What do you see?

```


```{r}
## plotting df2_cumsum
p1 <-  ggplot(data=df2_cumsum, aes(x=dose, y=len, fill=len)) +
       geom_bar(stat="identity") +
       geom_text(aes(y=label_ypos, label=label_ypos), vjust=1.6, 
       color="white", size=3.5) + 
       ggtitle("Unsorted")

# plotting Sorted df2_cumsum

p2 <-  ggplot(data=df2_cumsum_sorted, aes(x=dose, y=len, fill=len)) +
       geom_bar(stat="identity") +
       geom_text(aes(y=label_ypos, label=label_ypos), vjust=1.6, 
       color="white", size=3.5) +
      ggtitle("Sorted")

grid.arrange(p1,p2, ncol=2)

```
### adding dodge
```{r}
ggplot(data=df2, aes(x=dose, y=len, fill=supp)) +
      geom_bar(stat="identity", position=position_dodge())+
      geom_text(aes(label=len), vjust=1.6, color="blue",
      position = position_dodge(0.5), size=3.5)
```

### Augmenting additional visual elements
```{r}

# Adding reference line
## geom_hline(): This geom allows you to annotate the plot with horizontal lines

  ggplot(data=df1, aes(x=dose, y=len)) +
  geom_bar(stat="identity") +
  geom_hline(yintercept=20, linetype=1)

# Quiz: Try to change the linetype by using numbers 1-10. What do you observe. Can you change the color to "red"?
 ggplot(data=df1, aes(x=dose, y=len)) +
  geom_bar(stat="identity") +
  geom_hline(yintercept=20, linetype=1, color='red')

```

```{r}
  ## use 'mean' as a reference for the yintercept
  ggplot(data=df1, aes(x=dose, y=len)) +
          geom_bar(stat="identity") +
          geom_hline(yintercept=mean(df1$len), linetype="dashed", color="red")
```

```{r}
# Adding text
ggplot(data=df1, aes(x=dose, y=len)) +
        geom_bar(stat="identity") +
        geom_hline(yintercept=mean(df1$len), linetype="dashed", color="red")+
        geom_text(x=.7, y=16, label="Mean Value", color="blue")
```

```{r}
# annotate
ggplot(data=df1, aes(x=dose, y=len)) +
        geom_bar(stat="identity")+
        geom_hline(yintercept=mean(df1$len), linetype="dashed", color="red")+
        annotate(geom="text",x=2, y=16, label="Mean Value", color="blue") +
        annotate("rect", xmin = 1.7, xmax = 2.3, ymin = 15, ymax = 17, alpha = 0.2, color="blue", fill="lightblue")

```
### Alternate syntax
```{r}
## you can use geom_bar to input the data
ggplot() +
    geom_bar(data=df1, aes(x=dose, y=len),stat="identity")
```

** This is the end of this lab **
